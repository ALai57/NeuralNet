<!doctype html>
<html lang="en">
	<head>
		<link rel="stylesheet" href="./bootstrap.min.css"/>
		 <script type="text/javascript"
		   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_SVG">
		</script>
		
	</head>
	
	<body>	
		<script src="./jquery-3.2.1.min.js"> </script>
		<script src="./bootstrap.min.js"> </script>
		<script src="./d3.min.js"> </script>
		<script src="./d3.slider.js"></script>
		<script src="./d3.rebind.js"></script>
		
		
		
		<div class="container"> 
		<div class = "row"> <div class="col-md-6 col-md-offset-3">
			<h2>Hello!</h2>

			<p>This code explodes the equation.</p>
			<p></p>
		</div></div>
		<div id="NetworkGraph"></div>
		<div id="TableOut"></div>
				
		</div>
		<script>
		
			//SVG drawing size
			var wd = 600;
			var ht = 600;
			
		</script>
		<script src="./setupAxes.js"></script>		
		
		<script> 
			
			var svg = d3.select('svg');
			var theEqn = d3.select('svg').append("foreignObject")
			  .attr("width", 580)
			  .attr("height", 500)
    		  .attr('y',y(5))
			  .append("xhtml:body");
			
			
			theEqn.append('div')
				.style('font-size','60%')
				.attr('id','explodedEqn')
				.text(' \\[ \\Huge{ S_{pred} = \\frac{1}{1+e^{ - \\left(\\frac{w_5 }{1 + e^{-\\left(T\\cdot w_1+ {HR}\\cdot w_2 \\right)}} +\\frac{w_6}{1 + e^{-\\left(T\\cdot w_3+ {HR}\\cdot w_4\\right)}} \\right) } }  }  \\] ');
			
			var eqnWhole;
			var eqnRHS;
			var eqnTop_1,   eqnTop_Bar, eqnTop_Denom;
			var eqnDenom_1, eqnDenom_P, eqnDenom_e;
			var eqnExp1_n;
			var eqnX, eqnY, eqnZ;
			var eqnX_Right, eqnX_Left, eqnX_P;
			var eqnW5, eqnW6;
			
			var eqnTop_Bar_Previous;
			var eqnDenom_1_Previous, eqnDenom_P_Previous, eqnDenom_e_Previous;
			var eqnExp1_n_Previous;
			var eqnX_Previous, eqnY_Previous, eqnZ_Previous;
			var eqnX_Right_Previous, eqnX_Left_Previous, eqnX_P_Previous;
			var eqnW5_Previous, eqnW6_Previous;
			
			<!-- var eqnBar1; -->
			<!-- var eqn1; -->
			<!-- var eqnBar23; -->
			<!-- var eqnW56; -->
			<!-- var eqn1P; -->
			<!-- var eqne; -->
			
			<!-- var eqn2P; -->
			<!-- var eqnL; -->
			<!-- var eqnR; -->
			<!-- var eqnAy; -->
			<!-- var eqnAz; -->
			
			MathJax.Hub.Queue(function () {
				<!-- mathInit(); -->
				
				//Parsing whole equation
				var theSVG = d3.select('#explodedEqn').selectAll('svg')
						.attr('width',580)
						.attr('height',580);
				
				eqnWhole = theSVG.selectAll(function(){return this.childNodes;});
				eqnWhole.attr('transform', "matrix(1, 0, 0, -1, 0, -20000)" )
						.attr('id','eqn_Whole');
				
				eqnRHS = eqnWhole.selectAll(function(){return this.childNodes})
							     .filter(function(d,i){return i === 3;});
				eqnRHS.attr('id','eqn_RHS');
				
				//Parsing the RHS of the equation
				var temp;
				temp = eqnRHS.selectAll(function(){return this.childNodes})
								.selectAll(function(){return this.childNodes});
				eqnTop_Bar   = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnTop_Bar');
				eqnTop_1     = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnTop_1');
				eqnTop_Denom = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnTop_Denom');
				
				//Parsing the denominator of the equation
				temp = eqnTop_Denom.selectAll(function(){return this.childNodes});
				eqnDenom_1     = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnDenom_1');
				eqnDenom_P     = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnDenom_P');;
				
				temp = temp.filter(function(d,i){return i === 2;})
									.selectAll(function(){return this.childNodes});
				eqnExp1_e     = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp1_e');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp1_n = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp1_n');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp1_leftP  = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp1_leftP');
				eqnX           = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnX');
				eqnExp1_rightP = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnExp1_rightP');
				
				//Parsing equation X
				temp = eqnX.selectAll(function(){return this.childNodes});
				eqnX_Left = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnX_Left');
				eqnX_P     = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnX_P');
				eqnX_Right = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnX_Right');
									
				temp = eqnX_Left.selectAll(function(){return this.childNodes});
				eqnX_Left_Bar = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnX_Left_Bar');
				eqnW5 = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnW5');
				eqnX_Left_Denom = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnX_Left_Denom');
				
				temp = eqnX_Right.selectAll(function(){return this.childNodes}).selectAll(function(){return this.childNodes});
				eqnX_Right_Bar = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnX_Right_Bar');
				eqnW6 = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnW6');
				eqnX_Right_Denom = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnX_Right_Denom');
				
				//Parsing left denominator of equation X
				temp = eqnX_Left_Denom.selectAll(function(){return this.childNodes});
				eqnX_Left_Denom_1 = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnX_Left_Denom_1');
				eqnX_Left_Denom_P = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnX_Left_Denom_P');
				
				temp = temp.filter(function(d,i){return i === 2;})
									.selectAll(function(){return this.childNodes});
				eqnExp2_e     = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp2_e');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp2_n = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp2_n');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp2_leftP  = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp2_leftP');
				eqnY           = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnY');
				eqnExp2_rightP = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnExp2_rightP');
									
				//Parsing right denominator of equation X					
				temp = eqnX_Right_Denom.selectAll(function(){return this.childNodes});
				eqnX_Right_Denom_1 = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnX_Right_Denom_1');
				eqnX_Right_Denom_P = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnX_Right_Denom_P');
				
				temp = temp.filter(function(d,i){return i === 2;})
									.selectAll(function(){return this.childNodes});
				eqnExp3_e     = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp3_e');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp3_n = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp3_n');
				
				temp = temp.filter(function(d,i){return i === 1;})
									.selectAll(function(){return this.childNodes});
				eqnExp3_leftP  = temp.filter(function(d,i){return i === 0;})
									.attr('id','eqnExp3_leftP');
				eqnZ           = temp.filter(function(d,i){return i === 1;})
									.attr('id','eqnZ');
				eqnExp3_rightP = temp.filter(function(d,i){return i === 2;})
									.attr('id','eqnExp3_rightP');
						
				d3.select('#explodedEqn').selectAll('svg').attr('viewBox',"0 -4000 64078 9602.6");
				
				//Get initial settings
				eqnX_Previous        =  eqnX.attr('transform');
				eqnTop_Bar_Previous  = [eqnTop_Bar.attr('width'),
										eqnTop_Bar.attr('x')];
				eqnDenom_1_Previous  = [eqnDenom_1.attr('x'),
										eqnDenom_1.attr('y')];
				eqnDenom_P_Previous  = [eqnDenom_P.attr('x'),
										eqnDenom_P.attr('y')];
				eqnExp1_e_Previous   = [eqnExp1_e.attr('x'),
										eqnExp1_e.attr('y')];
				eqnExp1_n_Previous   = [eqnExp1_n.attr('x'),
										eqnExp1_n.attr('y')];
				eqnX_P_Previous      =  eqnX_P.attr('transform');
				eqnX_Right_Previous  =  eqnX_Right.attr('transform');
				eqnW5_Previous       =  eqnW5.attr('transform');
				eqnW6_Previous       =  eqnW6.attr('transform');
			});

			function explodeEqn(){
				eqnX.transition().duration(1000)
						.attr('transform', 'translate(-4500,-8000)')
						.on('end',function(){
						
				eqnTop_Bar.transition().duration(1000)
					.attr('width',10000)
					.attr('x',13000);
				eqnTop_1.transition().duration(1000)
					.attr('x',7000)
					.attr('y',800);
				eqnDenom_1.transition().duration(1000)
                    .attr('x',5800)
					.attr('y',1000);
				eqnDenom_P.transition().duration(1000)
                    .attr('x',6300)
					.attr('y',1000);
				eqnExp1_leftP.transition().duration(100)
					.style('opacity',0);
				eqnExp1_rightP.transition().duration(100)
					.style('opacity',0);
				eqnExp1_n.transition().duration(1000)
					.attr('x',7000)
					.attr('y',1100);
				
				eqnExp1_e.transition().duration(1000)
					.attr('y',1000)
					.attr('x',5700)
					.on('end',function(){
						
				d3.selectAll('svg').selectAll('#xvar_Neuron3').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','xvar_Neuron3')
					.transition().delay(500)
					.attr('x', x(-1.1))
					.attr('y', y(1.46))
					.style('opacity',1)
					.text('x =')
					.style('font-size','18pt')
					.style('font-family','Times');
					
				d3.selectAll('svg').selectAll('#xvar_Eqn').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','xvar_Eqn')
					.transition().delay(500)
					.attr('x', x(3.7))
					.attr('y', y(3.1))
					.style('opacity',1)
					.text('x')
					.style('font-family','Times')
					.style('font-size','18pt');	
				
				svg.selectAll('#neuron3').data([0])
					.enter().append('circle')
					.style('fill','none')
					.style('stroke','red')
					.attr('id','neuron3')
					.transition().delay(500)
					.attr('cx', x(3.2))
					.attr('cy', y(3.3))
                    .attr('r', 60);
				
					});
					
				});
			
			}
			
			function undoExplodeEqn(){
			
				d3.selectAll('svg').selectAll('#xvar_Eqn').remove();
				d3.selectAll('svg').selectAll('#xvar_Neuron3').remove();
				d3.selectAll('svg').selectAll('#neuron3').remove();
			
				eqnX.transition().duration(1000)
						.attr('transform', eqnX_Previous);
						
				eqnTop_Bar.transition().duration(1000)
					.attr('width',eqnTop_Bar_Previous[0])
					.attr('x',eqnTop_Bar_Previous[1]);
				eqnDenom_1.transition().duration(1000)
					.attr('x',eqnDenom_1_Previous[0])
					.attr('y',eqnDenom_1_Previous[1]);
				eqnDenom_P.transition().duration(1000)
					.attr('x',eqnDenom_P_Previous[0])
					.attr('y',eqnDenom_P_Previous[1]);
				eqnExp1_e.transition().duration(1000)
					.attr('x',eqnExp1_e_Previous[0])
					.attr('y',eqnExp1_e_Previous[1]);
				eqnExp1_n.transition().duration(1000)
					.attr('x',eqnExp1_n_Previous[0])
					.attr('y',eqnExp1_n_Previous[1])
					.on('end',function(){
				eqnExp1_leftP.transition().delay(250).duration(100)
					.style('opacity',1);
				eqnExp1_rightP.transition().delay(250).duration(100)
					.style('opacity',1);
					});
				
			}
			
			function explodeEqn2(){
				eqnX_P.transition().duration(1000)
					.attr('transform','scale(2.4)');
				eqnX_Right.transition().duration(1000)
					.attr('transform','translate(28000,0)');
				
				eqnW5.transition().duration(1000)
					.attr('transform','translate(21000,0)');
					
				eqnW6.transition().duration(1000)
					.attr('transform','translate(21000,0)');	
				
				svg.selectAll('.myones').data([1.8,7])
					.enter().append('text')
					.attr('class','myones')
					.text('1')
					.style('font-family','Times')
					.style('opacity',0)
					.style('font-size',22)
					.attr('x',function(d){return x(d);})
					.attr('y',y(1.7))
					.transition().duration(1000)
					.style('opacity',1);
					
				svg.selectAll('.dots').data([1.95+1.8,7+1.8])
					.enter().append('text')
					.attr('class','dots')
					.text('.')
					.style('font-family','Times')
					.style('opacity',0)
					.style('font-size',62)
					.attr('x',function(d){return x(d);})
					.attr('y',y(1.5))
					.transition().duration(1000)
					.style('opacity',1);	
			}
			
			function undoExplodeEqn2(){
				
				d3.selectAll('svg').selectAll('.myones').remove();	
				d3.selectAll('svg').selectAll('.dots').remove();
				
				eqnX_P.transition().duration(1000)
					.attr('transform',eqnX_P_Previous);
				eqnX_Right.transition().duration(1000)
					.attr('transform',eqnX_Right_Previous);
				
				eqnW5.transition().duration(1000)
					.attr('transform',eqnW5_Previous);
				eqnW6.transition().duration(1000)
					.attr('transform',eqnW6_Previous);
					
			}
			
			function explodeEqn3(){
				var temp = svg.selectAll('.myones');
				
				temp.transition().duration(1000)
					.attr('y',y(-0.5));
					<!-- .attr('x',function(d,i){return x(0.4)+i*(x(6.15)-x(0));}); -->

				
				eqnAy1.transition().duration(1000)
					.attr('y',-14000);
					
                    <!-- .attr('x',4500); -->
				eqnAy2.transition().duration(1000)
					.attr('transform','translate(149,-17500)')
					.on('end',function(){
						
				d3.selectAll('svg').selectAll('#yvar').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','yvar')
					.transition().delay(500)
					.attr('x', x(-1.1))
					.attr('y', y(-0.8))
					.style('opacity',1)
					.text('y =')
					.style('font-size','18pt')
					.style('font-family','Times');
					
				d3.selectAll('svg').selectAll('#yvar2').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','yvar2')
					.style('font-size',22)
					.text('y')
					.transition().delay(500)
					.attr('x', x(1.4))
					.attr('y', y(1.46))
					.style('opacity',1)
					.style('font-family','Times');	
						
					});
					
				eqnAz1.transition().duration(1000)
					.attr('y',-14000)
					.attr('x',4500);
				eqnAz2.transition().duration(1000)
					.attr('transform','translate(5000,-17500)')
					.on('end',function(){
						
				d3.selectAll('svg').selectAll('#zvar').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','zvar')
					.transition().delay(500)
					.attr('x', x(5.1))
					.attr('y', y(-0.8))
					.style('opacity',1)
					.text('z =')
					.style('font-size','18pt')
					.style('font-family','Times');
					
				d3.selectAll('svg').selectAll('#zvar2').data([0])
					.enter().append('text')
					.style('opacity',0)
					.attr('id','zvar2')
					.style('font-size',22)
					.text('z')
					.transition().delay(500)
					.attr('x', x(7))
					.attr('y', y(1.46))
					.style('opacity',1)
					.style('font-family','Times')
					.on('end',function(){return consolidateXeqn();});
					
				
					});
			}
			
			function consolidateXeqn(){
				d3.selectAll('#xvar').transition().duration(1000)
					.attr('x',x(0)); 
				<!-- 45 -->
				d3.selectAll('#yvar2').transition().duration(1000)
					.attr('x',x(1.75));
				d3.selectAll('.dots').transition().duration(1000)
					.attr('x',function(d,i){return x(2.1)+i*125;});
				eqnW56.transition().duration(1000)
					.attr('transform',function(d,i){if(i===0){return 'translate(14000,0)';} else {return 'translate(-1000,0)';} });
				eqn2P.transition().duration(1000)
					.attr('x',6400);
				d3.selectAll('#zvar2').transition().duration(1000)
					.attr('x',x(4.2));
					
				svg.selectAll('#input3').data([0])
					.enter().append('rect')
					.style('fill','none')
					.style('stroke','red')
					.attr('id','input3')
					.transition().delay(500)
					.attr('x',170)
					.attr('y',185)
					.attr('rx', 20)
					.attr('ry', 20)
					.attr('width',230)
					.attr('height',50);
			}
			
			function explodeEqn4(){
				svg.selectAll('.myones').transition().duration(1000)
					.attr('x',function(d,i){return x(0.4)+i*(x(6.15)-x(0));});
			
				eqnY.transition().duration(1000)
						.attr('transform', 'translate(-5000,-8500)')
						.on('end',function(){
						
					d3.selectAll('svg').selectAll('#yvar')
						.transition().delay(500)
						.attr('x', x(-1.5));
						
						
						});
				
				eqnBar23.transition().duration(1000)
					.attr('width',8000);
				
						
				eqnZ.transition().duration(1000)
						.attr('transform', 'translate(-5000,-8500)')
						.on('end',function(){
						
				d3.selectAll('svg').selectAll('#zvar')
					.transition().delay(500)
					.attr('x', x(4.7));
					

				svg.selectAll('#neuron2').data([0])
					.enter().append('circle')
					.style('fill','none')
					.style('stroke','red')
					.attr('id','neuron2')
					.transition().delay(500)
					.attr('cx', x(6.7))
					.attr('cy', y(-0.7))
                    .attr('r', 60);
					
				svg.selectAll('#neuron1').data([0])
					.enter().append('circle')
					.style('fill','none')
					.style('stroke','red')
					.attr('id','neuron1')
					.transition().delay(500)
					.attr('cx', x(0.6))
					.attr('cy', y(-0.7))
                    .attr('r', 60);		
					});	
			}
			
			
			
		</script>
		<script>
			
		</script>
	
	</body>
	
</html>